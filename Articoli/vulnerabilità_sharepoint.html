<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline'; style-src 'self' https://fonts.googleapis.com https://cdn.jsdelivr.net 'unsafe-inline'; font-src https://fonts.gstatic.com; img-src 'self' data:; media-src 'self'; frame-ancestors 'none';">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <title>ToolShell: La Minaccia Zero-Day che Scuote SharePoint | thevirtueye</title>

    <!-- Importa Nunito Sans da Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:opsz,wght@6..12,400;6..12,500&display=swap"
        rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css"
        integrity="sha384-ltWbn5KbNVFiXh4W66I10Q6yC4c0JwJ53lwiCFclqXXdnfoEbafj3b4lBSGvq7WW" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "Article",
          "headline": "ToolShell: La Minaccia Zero-Day che Scuote SharePoint",
          "author": {
            "@type": "Person",
            "name": "Alberto Cirillo",
            "url": "https://thevirtueye.com"
          },
          "datePublished": "2025-07-23",
          "description": "Analisi approfondita della campagna ToolShell che sfrutta le vulnerabilità CVE-2025-53770 e CVE-2025-53771 in Microsoft SharePoint, con oltre 85 server compromessi a livello globale."
        }
        </script>

    <!-- Stile personalizzato -->
    <style>
        .logo {
            font-family: 'Nunito Sans', sans-serif;
        }

        /* Tema chiaro (default) */
        :root {
            --bg-color: rgba(30, 30, 30, 0.7);
            --text-color: #f7fafc;
            --border-color: #2d3748;
            --card-bg: #2d3748;
            --card-text: #e2e8f0;
            --secondary-bg: rgba(26, 32, 44, 0.8);
            --button-bg: #e2e8f0;
            --button-text: #1a202c;
            --card-shadow: 0px 6px 15px rgba(0, 0, 0, 0.25);
            --section-bg: rgba(26, 32, 44, 0.8);
            --card-border: 1px solid rgba(255, 255, 255, 0.05);
        }

        body {
            color: var(--text-color);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            line-height: 1.7;
        }

        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: transparent;
            z-index: 1000;
        }

        nav {
            padding: 1rem 2rem;
            position: fixed;
            top: 40px;
            left: 0;
            width: 100%;
            background-color: transparent;
            z-index: 1000;
        }

        header,
        nav {
            background-color: transparent;
            transition: background-color 0.3s ease;
        }

        .scrolled {
            background-color: transparent !important;
        }

        .theme-border {
            border-color: var(--border-color);
        }

        .theme-text {
            color: var(--text-color);
        }

        .theme-secondary-text {
            color: var(--card-text);
        }

        .theme-secondary-bg {
            background-color: var(--secondary-bg);
        }

        /* Video background */
        #background-video {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -1000;
            object-fit: cover;
        }

        /* Overlay per rendere il contenuto più leggibile */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: -999;
        }

        .content-wrapper {
            position: relative;
            z-index: 1;
        }

        /* Stile per l'articolo */
        .article-container {
            max-width: 1100px;
            margin: 110px auto 60px;
            padding: 0 20px;
        }

        .article-header {
            margin-bottom: 40px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 30px;
            text-align: center;
        }

        .article-metadata {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 24px;
            color: #d1d5db;
            font-size: 0.9rem;
        }

        .article-tags {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .article-tag {
            background-color: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            font-size: 12px;
            font-weight: 500;
            padding: 3px 8px;
            border-radius: 4px;
        }

        .article-content {
            font-size: 1.1rem;
            line-height: 1.8;
            max-width: 900px;
            margin: 0 auto;
        }

        .article-content h2 {
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 1.8rem;
            color: #ffffff;
        }

        .article-content h3 {
            margin-top: 30px;
            margin-bottom: 16px;
            font-size: 1.4rem;
            color: #ffffff;
        }

        .article-content p {
            margin-bottom: 20px;
        }

        .article-content ul,
        .article-content ol {
            margin-bottom: 20px;
            margin-left: 20px;
        }

        .article-content li {
            margin-bottom: 8px;
        }

        .article-content code {
            background-color: rgba(74, 85, 104, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        .article-content pre {
            background-color: rgba(26, 32, 44, 0.6);
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 24px;
        }

        .breadcrumb {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            font-size: 0.9rem;
            color: #d1d5db;
        }

        .breadcrumb a {
            color: #60a5fa;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 40px;
            height: 40px;
            background-color: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .back-to-top.visible {
            opacity: 1;
        }

        .table-of-contents {
            background-color: rgba(26, 32, 44, 0.6);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            max-width: 800px;
            margin: 0 auto 40px;
        }

        .table-of-contents h3 {
            margin-top: 0;
            margin-bottom: 16px;
        }

        .table-of-contents ul {
            margin-left: 0;
            list-style: none;
        }

        .table-of-contents li {
            margin-bottom: 8px;
        }

        .table-of-contents a {
            color: #60a5fa;
            text-decoration: none;
        }

        .table-of-contents a:hover {
            text-decoration: underline;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #e2e8f0;
            text-decoration: none;
            margin-bottom: 30px;
        }

        .back-link:hover {
            color: #60a5fa;
        }

        .article-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .fade-in-section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .fade-in-section.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Stile per gli alert box */
        .alert-box {
            background-color: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
            padding: 20px;
            margin: 24px 0;
            border-radius: 8px;
        }

        .alert-box-warning {
            background-color: rgba(245, 158, 11, 0.1);
            border-left: 4px solid #f59e0b;
        }

        .alert-box-info {
            background-color: rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
        }

        @media (max-width: 768px) {
            .article-container {
                margin-top: 120px;
                padding: 0 16px;
            }

            .article-header h1 {
                font-size: 1.8rem;
            }

            .article-content {
                font-size: 1rem;
            }
        }

        #scroll-content {
            clip-path: inset(0 0 0 0);
            -webkit-clip-path: inset(0 0 0 0);
        }

        footer {
            margin-top: -30px !important;
        }

        .article-container {
            margin-bottom: 20px;
        }

        .article-content section:last-of-type p:last-child {
            margin-bottom: 30px;
        }

        /* Modifica il posizionamento dell'header su mobile per farlo scorrere con la pagina */
        @media (max-width: 768px) {
            header {
                position: relative !important;
                background-color: transparent !important;
                box-shadow: none;
            }

            #scroll-content {
                padding-top: 0 !important;
            }

            .article-container {
                margin-top: 20px !important;
            }

            .article-title {
                font-size: 1.8rem !important;
            }

            .article-content h2 {
                font-size: 1.5rem !important;
            }

            .article-content h3 {
                font-size: 1.3rem !important;
            }

            .article-content pre {
                padding: 10px;
                font-size: 0.9rem;
            }
        }

        /* Video background responsiveness */
        @media (max-width: 768px) {
            #background-video {
                position: fixed;
                object-position: center center;
                object-fit: cover;
                width: 100vw;
                height: 100vh;
                transform: translateZ(0);
                will-change: transform;
            }

            .overlay {
                background: rgba(0, 0, 0, 0.8);
            }
        }

        @media (max-width: 768px) {
            .article-content {
                font-size: 1rem;
                line-height: 1.6;
                padding: 0 10px;
            }

            .article-header {
                padding-bottom: 20px;
                margin-bottom: 20px;
            }

            .article-metadata {
                flex-direction: column;
                gap: 10px;
            }

            .table-of-contents {
                padding: 15px;
                margin-bottom: 20px;
            }

            .back-to-top {
                bottom: 20px;
                right: 20px;
                width: 35px;
                height: 35px;
            }

            .article-content ul,
            .article-content ol {
                padding-left: 20px;
            }
        }

        @media (max-width: 480px) {
            .article-title {
                font-size: 1.5rem !important;
            }

            .article-content h2 {
                font-size: 1.3rem !important;
            }

            .article-container {
                padding: 0 12px;
            }

            .social-icons {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 768px) {
            body {
                line-height: 1.5;
            }

            .article-content p {
                margin-bottom: 18px;
            }

            footer {
                padding-top: 30px !important;
                padding-bottom: 20px !important;
            }
        }

        @media (max-width: 768px) {
            header .logo {
                font-size: 2rem !important;
            }

            header .absolute {
                width: 100%;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            header .logo {
                font-size: 1.8rem !important;
            }
        }

        @media (max-width: 768px) {
            .article-container {
                margin-top: 0px !important;
                padding-top: 20px;
            }

            .article-header {
                padding-top: 20px;
                margin-top: 20px;
            }
        }
    </style>
</head>

<body>
    <!-- Video di sfondo -->
    <video autoplay muted loop playsinline id="background-video" preload="auto" poster="/assets/screenshot.png">
        <source src="/assets/background2.mp4" type="video/mp4">
        Il tuo browser non supporta i video HTML5.
    </video>

    <!-- Overlay per migliorare la visibilità del testo -->
    <div class="overlay"></div>

    <div class="content-wrapper">
        <header class="py-5 px-8 theme-border relative">
            <!-- Logo al centro (posizionato in modo assoluto) -->
            <div class="absolute left-1/2 transform -translate-x-1/2">
                <span class="logo text-3xl font-bold italic tracking-wider theme-text">thevirtueye</span>
            </div>
        </header>

        <!-- Menu di navigazione separato -->
        <nav class="py-4 px-8 border-b mt-3.5" style="border-color: rgba(255, 255, 255, 0);">
            <div class="container mx-auto flex justify-center">
            </div>
        </nav>

        <div id="scroll-content">

            <!-- Contenuto Articolo -->
            <main class="article-container">
                <div class="breadcrumb" style="display: none">
                    <a href="/index.html#home">Home</a>
                    <span>/</span>
                    <a href="/index.html#approfondimenti">Approfondimenti</a>
                    <span>/</span>
                    <span>ToolShell: La Minaccia Zero-Day</span>
                </div>

                <article>
                    <div class="article-header fade-in-section">
                        <h1 class="article-title">ToolShell: La Minaccia Zero-Day che Scuote SharePoint - Analisi della
                            Campagna di Attacchi Globali</h1>

                        <div class="article-metadata">
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round"
                                    style="display: inline-block; vertical-align: middle; margin-right: 4px;">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                                <span>23 Luglio 2025</span>
                            </div>
                        </div>

                        <div class="article-tags">
                            <span class="article-tag">SharePoint</span>
                            <span class="article-tag">Zero-Day</span>
                            <span class="article-tag">ToolShell</span>
                            <span class="article-tag">CVE-2025-53770</span>
                            <span class="article-tag">Microsoft</span>

                        </div>
                    </div>

                    <div class="article-content">
                        <section id="introduzione" class="fade-in-section">
                            <h2>1. L'Estate delle Vulnerabilità Microsoft</h2>
                            <p>
                                Il 2025 si sta rivelando un anno particolarmente critico per la sicurezza dei prodotti
                                Microsoft. Quella che doveva essere una tranquilla estate si è trasformata in una corsa
                                contro il tempo per i team di sicurezza di tutto il mondo, con l'emergere di
                                vulnerabilità critiche che hanno messo a rischio milioni di dispositivi e infrastrutture
                                aziendali.
                            </p>
                            <p>
                                L'escalation è iniziata con la scoperta di CVE-2025-33053, una vulnerabilità RCE in
                                Windows attivamente sfruttata dal gruppo APT Stealth Falcon. Quasi contemporaneamente, è
                                emersa EchoLeak (CVE-2025-32711), una grave falla in Microsoft Copilot che permette
                                l'esfiltrazione silenziosa di dati via email senza alcuna interazione utente. Ma il
                                peggio doveva ancora arrivare.
                            </p>
                            <p>
                                Con queste vulnerabilità ancora fresche nella memoria, l'attenzione si è improvvisamente
                                spostata su una nuova minaccia ad alto impatto: ToolShell. Questa campagna di attacchi,
                                che sfrutta le vulnerabilità zero-day CVE-2025-53770 e CVE-2025-53771, rappresenta una
                                delle minacce più serie per le infrastrutture SharePoint degli ultimi anni.
                            </p>
                        </section>

                        <section id="scoperta" class="fade-in-section">
                            <h2>2. La Scoperta di ToolShell</h2>

                            <div class="alert-box">
                                <strong>⚠️ Allarme Critico:</strong> Oltre 85 server SharePoint sono stati confermati
                                compromessi a livello mondiale. Gli attacchi sono in corso dal 18 luglio 2025 senza
                                patch ufficiali disponibili.
                            </div>

                            <h3>2.1 Timeline degli eventi</h3>
                            <p>
                                La campagna ToolShell è stata scoperta in circostanze allarmanti:
                            </p>
                            <ul>
                                <li><strong>● 18 luglio 2025</strong>: Primi attacchi documentati (retrospettivamente
                                    identificati)</li>
                                <li><strong>● 19 luglio 2025</strong>: Aumento anomalo di compromissioni SharePoint
                                    rilevato</li>
                                <li><strong>● 20 luglio 2025</strong>: CISA emette un alert di emergenza</li>
                                <li><strong>● 21 luglio 2025</strong>: Microsoft conferma lo sfruttamento attivo</li>
                                <li><strong>● 22 luglio 2025</strong>: Identificazione di oltre 85 server compromessi
                                    globalmente</li>
                            </ul>

                            <h3>2.2 Il contesto allarmante</h3>
                            <p>
                                Il report BeyondTrust sulle vulnerabilità Microsoft del 2025 ha rivelato dati
                                preoccupanti: un numero record di 1.360 vulnerabilità divulgate nel 2024, con un aumento
                                dell'11% rispetto al precedente picco. Questo trend evidenzia non solo la crescente
                                superficie di attacco, ma anche l'urgente necessità per le organizzazioni di adattarsi
                                proattivamente a un panorama di minacce in continua evoluzione.
                            </p>
                            <p>
                                Con oltre 1,4 miliardi di dispositivi alimentati da Windows e la dipendenza globale dai
                                servizi Microsoft, ogni vulnerabilità critica ha il potenziale per causare danni su
                                scala mondiale. ToolShell ne è la dimostrazione più recente e pericolosa.
                            </p>
                        </section>

                        <section id="analisi-tecnica" class="fade-in-section">
                            <h2>3. Anatomia della Vulnerabilità CVE-2025-53770</h2>

                            <h3>3.1 Caratteristiche tecniche</h3>
                            <p>
                                La CVE-2025-53770 è classificata come una vulnerabilità di sicurezza altamente critica
                                con un punteggio CVSS di 9.8 su 10. Questa valutazione estrema riflette la gravità della
                                minaccia:
                            </p>
                            <ul>
                                <li><strong>● Vettore di attacco</strong>: Rete - Accessibile da remoto</li>
                                <li><strong>● Complessità dell'attacco</strong>: Bassa - Facile da sfruttare</li>
                                <li><strong>● Privilegi richiesti</strong>: Nessuno - Non serve autenticazione</li>
                                <li><strong>● Interazione utente</strong>: Nessuna - Completamente automatizzabile</li>
                                <li><strong>● Impatto</strong>: Critico su confidenzialità, integrità e disponibilità
                                </li>
                            </ul>

                            <div class="alert-box alert-box-warning">
                                <strong>🔍 Dettaglio Tecnico:</strong> La vulnerabilità è considerata una variante della
                                precedente CVE-2025-49704, una falla di iniezione di codice e RCE parzialmente corretta
                                nel Patch Tuesday di luglio 2025.
                            </div>

                            <h3>3.2 Meccanismo di sfruttamento</h3>
                            <p>
                                L'attività di sfruttamento denominata "ToolShell" opera attraverso un processo
                                sofisticato:
                            </p>
                            <ol>
                                <li><strong>● Accesso iniziale</strong>: L'attaccante ottiene accesso non autenticato ai
                                    sistemi vulnerabili</li>
                                <li><strong>● Deserializzazione malevola</strong>: Sfrutta la deserializzazione di dati
                                    non attendibili in istanze SharePoint on-premises</li>
                                <li><strong>● Esecuzione di codice</strong>: Permette RCE da parte di un attaccante non
                                    autenticato attraverso la rete</li>
                                <li><strong>● Privilege escalation</strong>: Fornisce pieno accesso ai contenuti di
                                    SharePoint, inclusi archivi di file e configurazioni interne</li>
                                <li><strong>● Persistenza</strong>: Gli avversari possono falsificare payload
                                    affidabili, mascherandosi come operazioni legittime di SharePoint</li>
                            </ol>

                            <h3>3.3 Versioni vulnerabili</h3>
                            <p>
                                Microsoft ha confermato che le seguenti versioni sono affette:
                            </p>
                            <ul>
                                <li>● SharePoint Server 2019 (tutte le build precedenti l'aggiornamento di sicurezza)
                                </li>
                                <li>● SharePoint Server 2016 (EOL ma ancora ampiamente utilizzato)</li>
                                <li>● SharePoint Subscription Edition</li>
                                <li>● SharePoint Server 2013 (supporto esteso)</li>
                            </ul>
                            <p>
                                <strong>Nota importante</strong>: SharePoint Online in Microsoft 365 non è interessato
                                da questa vulnerabilità, confermando ancora una volta i vantaggi di sicurezza delle
                                soluzioni cloud-native.
                            </p>
                        </section>

                        <section id="campagna-attacchi" class="fade-in-section">
                            <h2>4. La Campagna di Attacchi ToolShell</h2>

                            <h3>4.1 Infrastruttura degli attaccanti</h3>
                            <p>
                                CISA ha identificato diversi indicatori di compromissione (IoC) associati alla campagna:
                            </p>
                            <pre><code># Indirizzi IP malevoli identificati
107.191.58[.]76    - Command & Control primario
104.238.159[.]149  - Server di staging per payload
96.9.125[.]147     - Exfiltration endpoint

# Pattern di richieste sospette
POST /ToolPane.aspx?DisplayMode=Edit
POST /_layouts/15/ToolPane.aspx
POST /_vti_bin/client.svc/ProcessQuery</code></pre>

                            <h3>4.2 Tecniche di attacco osservate</h3>
                            <p>
                                Gli attaccanti hanno dimostrato sofisticate capacità operative:
                            </p>
                            <ul>
                                <li><strong>● Scansioni mirate</strong>: Identificazione automatizzata di server
                                    SharePoint vulnerabili</li>
                                <li><strong>● Payload polimorfici</strong>: Variazione continua del codice per evadere i
                                    sistemi di rilevamento</li>
                                <li><strong>● Living off the land</strong>: Utilizzo di strumenti legittimi di Windows
                                    per ridurre la detection</li>
                                <li><strong>● Backdoor sofisticate</strong>: Installazione di webshell nascoste nei file
                                    di sistema SharePoint</li>
                                <li><strong>● Lateral movement</strong>: Utilizzo di SharePoint come pivot point per
                                    attaccare l'intera rete</li>
                            </ul>

                            <h3>4.3 Obiettivi e vittime</h3>
                            <p>
                                L'analisi delle vittime confermate rivela un pattern preoccupante:
                            </p>
                            <ul>
                                <li>● Settore governativo: 35% delle compromissioni</li>
                                <li>● Infrastrutture critiche: 25%</li>
                                <li>● Servizi finanziari: 20%</li>
                                <li>● Healthcare: 15%</li>
                                <li>● Altri settori: 5%</li>
                            </ul>
                            <p>
                                La concentrazione su settori critici suggerisce che gli attacchi potrebbero essere
                                sponsorizzati da stati nazionali o gruppi APT avanzati con obiettivi di spionaggio o
                                sabotaggio.
                            </p>
                        </section>

                        <section id="risposta-microsoft" class="fade-in-section">
                            <h2>5. La Risposta di Microsoft e le Mitigazioni</h2>

                            <div class="alert-box alert-box-info">
                                <strong>📌 Aggiornamento Critico:</strong> Microsoft ha rilasciato aggiornamenti di
                                sicurezza di emergenza per SharePoint Subscription Edition e SharePoint Server 2019.
                                L'installazione immediata è essenziale.
                            </div>

                            <h3>5.1 Patch e aggiornamenti</h3>
                            <p>
                                Microsoft ha risposto all'emergenza con un approccio graduale:
                            </p>
                            <ul>
                                <li><strong>● Patch parziali immediate</strong>: Rilasciate per SharePoint Subscription
                                    Edition e Server 2019</li>
                                <li><strong>● Mitigazioni temporanee</strong>: Fornite in attesa della correzione
                                    completa</li>
                                <li><strong>● Testing approfondito</strong>: Una correzione completa è in fase di test e
                                    sarà rilasciata in futuro</li>
                            </ul>
                            <p>
                                Il vendor ha sottolineato che gli aggiornamenti attuali affrontano solo parzialmente il
                                problema, rendendo cruciale l'implementazione di misure di mitigazione aggiuntive.
                            </p>


                            <h3>5.2 Script di verifica PowerShell</h3>
                            <p>
                                Microsoft ha fornito uno script per verificare la presenza di compromissioni:
                            </p>
                            <pre><code># Verifica compromissioni ToolShell
$compromiseIndicators = @(
    "*/ToolPane.aspx?DisplayMode=Edit*",
    "*/_layouts/*/ToolPane.aspx*",
    "*/_vti_bin/client.svc/ProcessQuery*"
)

# Analizza i log IIS
$iisLogs = Get-ChildItem "C:\inetpub\logs\LogFiles" -Recurse -Filter "*.log"
foreach ($log in $iisLogs) {
    $content = Get-Content $log.FullName
    foreach ($indicator in $compromiseIndicators) {
        if ($content -like $indicator) {
            Write-Warning "Possibile compromissione rilevata in: $($log.FullName)"
        }
    }
}

# Verifica processi sospetti
Get-Process | Where-Object {
    $_.Parent.ProcessName -eq "w3wp" -and 
    ($_.ProcessName -eq "powershell" -or $_.ProcessName -eq "cmd")
} | ForEach-Object {
    Write-Warning "Processo sospetto rilevato: $($_.ProcessName) con PID $($_.Id)"
}</code></pre>
                        </section>

                        <section id="collaborazione-cisa" class="fade-in-section">
                            <h2>6. La Risposta Coordinata CISA-Microsoft</h2>

                            <h3>6.1 L'intervento di CISA</h3>
                            <p>
                                Il 20 luglio, CISA ha emesso un alert di emergenza confermando lo sfruttamento attivo di
                                CVE-2025-53770. L'agenzia ha fornito indicazioni cruciali per la difesa:
                            </p>
                            <ul>
                                <li><strong>● Monitoraggio del traffico</strong>: Focus su richieste POST sospette verso
                                    <code>/ToolPane.aspx?DisplayMode=Edit</code>
                                </li>
                                <li><strong>● Blocco degli IP malevoli</strong>: Lista nera immediata degli indirizzi IP
                                    identificati</li>
                                <li><strong>● Aggiornamento IPS/WAF</strong>: Implementazione di regole specifiche per
                                    bloccare i pattern di attacco</li>
                                <li><strong>● Riduzione dei privilegi</strong>: Limitazione immediata dei privilegi di
                                    layout e amministrazione</li>
                            </ul>

                            <h3>6.2 L'importanza della difesa collettiva</h3>
                            <p>
                                Questo incidente sottolinea il ruolo critico della collaborazione nella cybersecurity
                                moderna:
                            </p>
                            <blockquote
                                style="border-left: 4px solid #3b82f6; padding-left: 20px; margin: 20px 0; font-style: italic;">
                                "La difesa informatica collettiva e gli sforzi coordinati tra governi, vendor privati e
                                comunità di ricerca sulla sicurezza sono essenziali per contrastare gli attori di
                                minaccia moderni, consentendo un rilevamento, una risposta e una resilienza più rapidi
                                di fronte ad attacchi di crescente sofisticazione."
                            </blockquote>
                            <p>
                                La rapidità con cui CISA e Microsoft hanno collaborato dimostra l'evoluzione positiva
                                nella risposta agli incidenti zero-day, ma evidenzia anche la necessità di meccanismi di
                                difesa ancora più proattivi.
                            </p>

                            <h3>6.3 Threat intelligence e IOC sharing</h3>
                            <p>
                                La condivisione tempestiva degli indicatori di compromissione ha permesso:
                            </p>
                            <ul>
                                <li>● Identificazione rapida di nuove vittime</li>
                                <li>● Blocco preventivo di infrastrutture malevole</li>
                                <li>● Comprensione delle TTP (Tactics, Techniques, and Procedures) degli attaccanti</li>
                                <li>● Sviluppo di contromisure efficaci in tempo reale</li>
                            </ul>
                        </section>

                        <section id="implicazioni-sicurezza" class="fade-in-section">
                            <h2>7. Implicazioni per la Sicurezza Enterprise</h2>

                            <div class="alert-box alert-box-warning">
                                <strong>⚠️ Rischio Sistemico:</strong> Con SharePoint al centro di molte infrastrutture
                                collaborative aziendali, questa vulnerabilità rappresenta un rischio sistemico per le
                                operazioni business globali.
                            </div>

                            <h3>7.1 L'effetto domino</h3>
                            <p>
                                Una compromissione SharePoint può innescare una cascata di conseguenze:
                            </p>
                            <ol>
                                <li><strong>● Perdita di proprietà intellettuale</strong>: Accesso a documenti riservati
                                    e progetti strategici</li>
                                <li><strong>● Violazione della compliance</strong>: Esposizione di dati soggetti a GDPR,
                                    HIPAA, o altre normative</li>
                                <li><strong>● Supply chain attacks</strong>: Utilizzo di SharePoint per colpire partner
                                    e fornitori</li>
                                <li><strong>● Ransomware deployment</strong>: Piattaforma ideale per la distribuzione di
                                    malware</li>
                                <li><strong>● Spionaggio industriale</strong>: Monitoraggio a lungo termine delle
                                    attività aziendali</li>
                            </ol>

                            <h3>7.2 Il costo della compromissione</h3>
                            <p>
                                Le organizzazioni colpite devono affrontare:
                            </p>
                            <ul>
                                <li><strong>● Costi diretti</strong>: Incident response, forensics, remediation (media:
                                    $4.5M per incidente maggiore)</li>
                                <li><strong>● Downtime operativo</strong>: Interruzione dei flussi di lavoro
                                    collaborativi</li>
                                <li><strong>● Danni reputazionali</strong>: Perdita di fiducia di clienti e partner</li>
                                <li><strong>● Sanzioni regolamentari</strong>: Multe per violazioni di compliance</li>
                                <li><strong>● Perdita di vantaggio competitivo</strong>: Furto di informazioni
                                    strategiche</li>
                            </ul>

                            <h3>7.3 Lezioni apprese</h3>
                            <p>
                                ToolShell evidenzia diverse criticità sistemiche:
                            </p>
                            <ul>
                                <li>● La dipendenza da sistemi legacy on-premises aumenta l'esposizione al rischio</li>
                                <li>● Le patch parziali possono creare un falso senso di sicurezza</li>
                                <li>● La detection basata su signature è insufficiente contro attacchi zero-day</li>
                                <li>● La segmentazione di rete rimane una difesa fondamentale</li>
                                <li>● L'importanza critica di piani di incident response testati</li>
                            </ul>
                        </section>

                        <section id="strategie-difensive" class="fade-in-section">
                            <h2>8. Strategie Difensive e Best Practices</h2>

                            <h3>8.1 Difesa in profondità per SharePoint</h3>
                            <p>
                                Un approccio multi-livello è essenziale per proteggere le infrastrutture SharePoint:
                            </p>
                            <pre><code># Architettura di sicurezza consigliata
┌─────────────────────────────────────┐
│         Perimetro Esterno           │
│  • WAF con regole anti-ToolShell    │
│  • DDoS Protection                  │
│  • Geo-blocking                     │
├─────────────────────────────────────┤
│         Livello di Rete            │
│  • Segmentazione VLAN               │
│  • IPS/IDS con signature custom     │
│  • Zero Trust Network Access        │
├─────────────────────────────────────┤
│      Livello Applicativo           │
│  • AMSI Integration                 │
│  • Application Control              │
│  • Behavioral Analytics             │
├─────────────────────────────────────┤
│        Livello Dati                │
│  • Encryption at rest               │
│  • Access controls                  │
│  • Data Loss Prevention             │
└─────────────────────────────────────┘</code></pre>

                            <h3>8.2 Automazione della risposta</h3>
                            <p>
                                Implementare playbook automatizzati per rispondere rapidamente:
                            </p>
                            <ol>
                                <li><strong>● Detection automatica</strong>: SIEM rules per identificare pattern
                                    ToolShell</li>
                                <li><strong>● Containment immediato</strong>: Isolamento automatico dei server
                                    compromessi</li>
                                <li><strong>● Evidence collection</strong>: Cattura automatica di log e memory dump</li>
                                <li><strong>● Notification workflow</strong>: Alert immediati al SOC e management</li>
                                <li><strong>● Recovery automation</strong>: Ripristino da backup verificati</li>
                            </ol>

                            <h3>8.3 Hardening checklist</h3>
                            <p>
                                Checklist essenziale per l'hardening di SharePoint:
                            </p>
                            <ul>
                                <li>● Applicare tutte le patch di sicurezza disponibili</li>
                                <li>● Abilitare AMSI e Windows Defender</li>
                                <li>● Implementare least privilege access</li>
                                <li>● Configurare logging dettagliato e retention</li>
                                <li>● Disabilitare protocolli e servizi non necessari</li>
                                <li>● Implementare network segmentation</li>
                                <li>● Configurare backup offline regolari</li>
                                <li>● Testare regolarmente i piani di DR</li>
                                <li>● Condurre penetration test periodici</li>
                                <li>● Formare il personale sulla threat awareness</li>
                            </ul>
                        </section>

                        <section id="futuro-sharepoint" class="fade-in-section">
                            <h2>9. Il Futuro di SharePoint e la Sicurezza Cloud</h2>

                            <h3>9.1 La migrazione al cloud come strategia di sicurezza</h3>
                            <p>
                                ToolShell rafforza l'argomento per la migrazione cloud:
                            </p>
                            <ul>
                                <li><strong>● SharePoint Online</strong>: Non vulnerabile a ToolShell grazie
                                    all'architettura cloud-native</li>
                                <li><strong>● Patching automatico</strong>: Microsoft gestisce gli aggiornamenti in
                                    tempo reale</li>
                                <li><strong>● Security by default</strong>: Protezioni avanzate integrate nella
                                    piattaforma</li>
                                <li><strong>● Threat intelligence</strong>: Beneficio della telemetria globale Microsoft
                                </li>
                                <li><strong>● Compliance built-in</strong>: Certificazioni e controlli già implementati
                                </li>
                            </ul>

                            <h3>9.2 L'evoluzione delle minacce</h3>
                            <p>
                                Le tendenze emergenti nel panorama delle minacce includono:
                            </p>
                            <ul>
                                <li><strong>● AI-powered attacks</strong>: Utilizzo di AI per scoprire e sfruttare
                                    vulnerabilità</li>
                                <li><strong>● Supply chain targeting</strong>: Focus su fornitori e integrazioni di
                                    terze parti</li>
                                <li><strong>● Living-off-the-land</strong>: Uso crescente di tool legittimi per evadere
                                    la detection</li>
                                <li><strong>● Ransomware-as-a-Service</strong>: Democratizzazione degli attacchi
                                    sofisticati</li>
                                <li><strong>● Zero-day hoarding</strong>: Accumulo di vulnerabilità per attacchi
                                    coordinati</li>
                            </ul>

                            <h3>9.3 Preparazione per il futuro</h3>
                            <p>
                                Le organizzazioni devono evolversi per rimanere sicure:
                            </p>
                            <ol>
                                <li><strong>● Adozione di Zero Trust</strong>: Nessuna fiducia implicita, verifica
                                    continua</li>
                                <li><strong>● Security automation</strong>: Risposta alle minacce alla velocità delle
                                    macchine</li>
                                <li><strong>● Continuous validation</strong>: Testing costante delle difese</li>
                                <li><strong>● Skills development</strong>: Investimento continuo nella formazione</li>
                                <li><strong>● Collaborative defense</strong>: Partecipazione attiva a community di
                                    sicurezza</li>
                            </ol>
                        </section>

                        <section id="conclusioni" class="fade-in-section">
                            <h2>10. Conclusioni e Call to Action</h2>

                            <div class="alert-box alert-box-info">
                                <strong>💡 Takeaway Principale:</strong> ToolShell non è solo un'altra vulnerabilità - è
                                un campanello d'allarme sulla necessità di ripensare fondamentalmente l'approccio alla
                                sicurezza delle infrastrutture collaborative.
                            </div>

                            <p>
                                La campagna ToolShell rappresenta un punto di svolta nella sicurezza di SharePoint. Con
                                oltre 85 server già compromessi e attacchi ancora in corso, l'urgenza di agire non può
                                essere sottovalutata. Questa vulnerabilità dimostra che anche le piattaforme enterprise
                                più mature possono nascondere falle critiche che mettono a rischio intere
                                organizzazioni.
                            </p>

                            <h3>Azioni immediate richieste</h3>
                            <p>
                                Per i CISO e i team di sicurezza, le priorità sono chiare:
                            </p>
                            <ol>
                                <li><strong>● Valutazione immediata</strong>: Identificare tutti i server SharePoint
                                    nell'ambiente</li>
                                <li><strong>● Patching d'emergenza</strong>: Applicare gli aggiornamenti disponibili
                                    entro 24 ore</li>
                                <li><strong>● Implementazione mitigazioni</strong>: Attivare AMSI e isolare i sistemi
                                    non patchabili</li>
                                <li><strong>● Threat hunting proattivo</strong>: Cercare attivamente segni di
                                    compromissione</li>
                                <li><strong>● Pianificazione strategica</strong>: Valutare la migrazione a SharePoint
                                    Online</li>
                            </ol>

                            <h3>Una nuova era per la sicurezza</h3>
                            <p>
                                ToolShell segna l'inizio di una nuova era in cui:
                            </p>
                            <ul>
                                <li>● Le vulnerabilità zero-day diventano sempre più sofisticate e mirate</li>
                                <li>● La collaborazione tra settore pubblico e privato è essenziale per la difesa</li>
                                <li>● L'architettura cloud-first offre vantaggi di sicurezza significativi</li>
                                <li>● L'automazione e l'AI diventano indispensabili per la difesa efficace</li>
                                <li>● La resilienza, non solo la prevenzione, deve essere l'obiettivo</li>
                            </ul>

                            <p>
                                In conclusione, ToolShell ci ricorda che nella cybersecurity moderna, la compiacenza è
                                il nemico più pericoloso. Solo attraverso vigilanza costante, collaborazione attiva e
                                innovazione continua possiamo sperare di rimanere un passo avanti agli avversari sempre
                                più determinati e capaci.
                            </p>

                            <p>
                                <strong>Il messaggio è chiaro</strong>: il tempo per agire è adesso. Ogni ora di ritardo
                                aumenta il rischio di diventare la prossima vittima di ToolShell. Proteggete i vostri
                                sistemi, educate i vostri team, e preparatevi per le sfide di domani. La sicurezza del
                                vostro SharePoint - e potenzialmente dell'intera infrastruttura aziendale - dipende
                                dalle azioni che intraprendete oggi.
                            </p>
                        </section>
                    </div>
                </article>

                <div style="text-align: center; margin-top: 60px; margin-bottom: 40px; display: none;">
                    <a href="/index.html#approfondimenti"
                        style="display: inline-block; background-color: #3b82f6; color: white; font-weight: 500; padding: 8px 20px; border-radius: 6px; text-decoration: none; transition: all 0.3s ease;">
                        ← Torna agli approfondimenti
                    </a>
                </div>

                <!-- Footer Section -->
                <footer class="border-t py-20 pb-1" style="border-color: rgba(255, 255, 255, 0);">
                    <div class="container mx-auto px-8 text-center">
                        <!-- Logo -->
                        <h2 class="logo text-xl font-bold italic tracking-wider theme-text mb-4">thevirtueye</h2>

                        <!-- Contatti essenziali -->
                        <div class="flex justify-center items-center mb-4">
                            <a href="mailto:thevirtueye1@gmail.com"
                                class="theme-secondary-text hover:underline flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z">
                                    </path>
                                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
                                </svg>
                                thevirtueye1@gmail.com
                            </a>
                        </div>

                        <!-- Social icons corretti -->
                        <div class="social-icons"
                            style="display: flex; justify-content: center; gap: 10px; margin: 15px 0;">
                            <a href="https://x.com/thevirtueye" target="_blank"
                                style="display: flex; align-items: center; justify-content: center; width: 30px; height: 30px; background-color: #292a2d; border-radius: 50%; transition: all 0.3s ease;">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                    style="width: 16px; height: 16px; fill: white;">
                                    <path
                                        d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z">
                                    </path>
                                </svg>
                            </a>
                            <a href="https://github.com/thevirtueye" target="_blank"
                                style="display: flex; align-items: center; justify-content: center; width: 30px; height: 30px; background-color: #292a2d; border-radius: 50%; transition: all 0.3s ease;">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                    style="width: 16px; height: 16px; fill: white;">
                                    <path
                                        d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.6.11.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z">
                                    </path>
                                </svg>
                            </a>

                            <!-- YouTube -->
                            <a href="https://www.youtube.com/@cirilloalberto2691" target="_blank"
                                style="display: flex; align-items: center; justify-content: center; width: 30px; height: 30px; background-color: #292a2d; border-radius: 50%; transition: all 0.3s ease;">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                    style="width: 16px; height: 16px; fill: white;">
                                    <path
                                        d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136C4.495 20.455 12 20.455 12 20.455s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z" />
                                </svg>

                            </a>
                            <!-- LinkedIn -->
                            <a href="https://www.linkedin.com/in/alberto-cirillo-3867a8348/" target="_blank"
                                style="display: flex; align-items: center; justify-content: center; width: 30px; height: 30px; background-color: #292a2d; border-radius: 50%; transition: all 0.3s ease;">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                    style="width: 16px; height: 16px; fill: white;">
                                    <path
                                        d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
                                </svg>
                            </a>
                        </div>

                        <!-- Divider -->
                        <div class="my-5">
                            <hr style="border-color: rgba(255, 255, 255, 0.2); padding: 1rem 0;">
                        </div>

                        <!-- Copyright e privacy -->
                        <div class="theme-secondary-text text-sm">
                            <p>&copy; 2025 thevirtueye. Tutti i diritti riservati.</p>
                            <p class="mt-2">
                                <a href="/Privacy-policy/privacy-policy.html" class="hover:underline mx-2">Privacy
                                    Policy</a>
                            </p>
                            <p class="mt-2 text-xs opacity-60 mb-0">
                                Le informazioni fornite su questo sito sono a scopo educativo. L'utente si assume ogni
                                responsabilità per il loro utilizzo.
                            </p>
                        </div>
                    </div>
                </footer>
        </div>

    </div>

    <script>
        'use strict';

        // Aggiungi questa funzione
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        document.addEventListener('DOMContentLoaded', () => {
            const nav = document.querySelector('nav');
            const extra = 20; // px extra sotto il nav
            const links = Array.from(nav.querySelectorAll('a[href^="#"]'));
            const scrollable = document.getElementById('scroll-content');

            // Flag per controllare se lo scroll è stato provocato da un clic su un link
            let isScrollingFromClick = false;
            // Link attualmente attivo
            let activeClickedLink = null;

            // Definisci i punti di trigger personalizzati per ogni sezione
            const sectionTriggers = {
                'home': {
                    triggerPoint: 0,
                    offset: 0
                },
                'chi-sono': {
                    triggerPoint: 0,
                    offset: 100
                },
                'progetti': {
                    triggerPoint: 0, // Modificato per migliorare la rilevazione
                    offset: 100
                },
                'approfondimenti': {
                    triggerPoint: 0, // Modificato per migliorare la rilevazione
                    offset: 100
                }
            };

            // Funzione per attivare il link corretto
            function activateLink(link) {
                links.forEach(l => {
                    l.classList.remove('font-bold');
                    const span = l.querySelector('span');
                    span.classList.remove('w-full');
                    span.classList.add('w-0');
                });

                if (link) {
                    link.classList.add('font-bold');
                    const span = link.querySelector('span');
                    span.classList.remove('w-0');
                    span.classList.add('w-full');
                }
            }

            // 1. Clip-path dinamico
            window.addEventListener('scroll', () => {
                const width = window.innerWidth;
                const mobileView = (!Number.isFinite(width) || width <= 768);

                if (mobileView) {
                    // Su mobile non serve il clip-path perché l'header scorre con la pagina
                    scrollable.style.clipPath = 'none';
                    scrollable.style.webkitClipPath = 'none';
                } else {
                    // Su desktop usa il calcolo originale
                    const hideLine = nav.getBoundingClientRect().bottom + extra;
                    const topWrap = scrollable.getBoundingClientRect().top;
                    const over = Math.max(hideLine - topWrap, 0);

                    // Validazione: assicurati che sia un numero finito e sicuro
                    const safeOver = Number.isFinite(over) ? Math.round(over) : 0;

                    scrollable.style.setProperty('clip-path', `inset(${safeOver}px 0 0 0)`);
                    scrollable.style.setProperty('-webkit-clip-path', `inset(${safeOver}px 0 0 0)`);
                }
            });

            // 2. Smooth-scroll con offset personalizzati
            links.forEach(link => {
                link.addEventListener('click', e => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href').slice(1);

                    // Validazione: accetta solo lettere, numeri e trattini
                    if (!/^[a-zA-Z0-9-]+$/.test(targetId)) {
                        console.error('ID non valido:', targetId);
                        return;
                    }

                    const target = document.getElementById(targetId);

                    if (!target) return;

                    // Attiva il link e imposta il flag
                    activateLink(link);
                    isScrollingFromClick = true;
                    activeClickedLink = link;

                    const navHeight = nav.getBoundingClientRect().height;
                    const customOffset = sectionTriggers[targetId]?.offset || 0;
                    const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - navHeight - customOffset;

                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });

                    // Resetta il flag dopo un intervallo
                    setTimeout(() => {
                        isScrollingFromClick = false;
                        activeClickedLink = null;
                    }, 1000);
                });
            });

            // 3. Observer migliorato per attivare i link durante lo scroll
            function checkActiveSection() {
                // Se stiamo scrollando da un clic, non cambiare il link attivo
                if (isScrollingFromClick) {
                    return;
                }

                const navHeight = nav.getBoundingClientRect().height;
                const scrollPosition = window.scrollY;

                // Ottieni tutte le sezioni nel documento
                const sections = links.map(link => {
                    const targetId = link.getAttribute('href').slice(1);
                    if (!/^[a-zA-Z0-9-]+$/.test(targetId)) {
                        return null;
                    }
                    return document.getElementById(targetId);
                }).filter(Boolean); // Rimuovi elementi null

                // Ordina le sezioni dall'ultima alla prima (per verificare prima quelle più basse nella pagina)
                const orderedSections = [...sections].reverse();

                // Calcola una zona buffer per migliorare la rilevazione
                const buffer = window.innerHeight / 4; // 25% dell'altezza della viewport

                // Trova la sezione attiva
                for (const section of orderedSections) {
                    const sectionTop = section.getBoundingClientRect().top + scrollPosition;
                    const sectionBottom = sectionTop + section.offsetHeight;

                    // Se il punto di viewport + buffer è all'interno della sezione, questa è attiva
                    if (scrollPosition + navHeight + buffer >= sectionTop && scrollPosition + navHeight < sectionBottom) {
                        const correspondingLink = links.find(link => link.getAttribute('href') === `#${section.id}`);
                        if (correspondingLink) {
                            activateLink(correspondingLink);
                            return;
                        }
                    }
                }

                // Se siamo qui, potremmo essere all'inizio della pagina, quindi attiva Home
                const isAtTop = scrollPosition < 100; // Considera i primi 100px come "all'inizio"
                if (isAtTop) {
                    const homeLink = links.find(link => link.getAttribute('href') === '#home');
                    if (homeLink) {
                        activateLink(homeLink);
                    }
                }
            }

            // Aggiungi l'event listener per lo scroll
            // Crea versioni debounced
            const debouncedCheckActiveSection = debounce(checkActiveSection, 100);

            window.addEventListener('scroll', debouncedCheckActiveSection);
            window.addEventListener('resize', debouncedCheckActiveSection);

            // Controlla anche quando il contenuto cambia (può essere utile in alcuni casi)
            const observer = new MutationObserver(checkActiveSection);
            const scrollContent = document.getElementById('scroll-content');

            if (scrollContent) {
                observer.observe(scrollContent, {
                    childList: true,
                    subtree: false,  // Cambiato da true a false
                    attributes: false,
                    characterData: false
                });
            }

            // Disconnetti l'observer quando la pagina viene chiusa
            window.addEventListener('beforeunload', () => {
                observer.disconnect();
            });

            // Esegui una prima verifica all'avvio
            checkActiveSection();

            // Funzione per verificare se siamo su mobile
            function isMobile() {
                return window.innerWidth <= 768;
            }

            // Ottimizzazione caricamento video su mobile
            const video = document.getElementById('background-video');

            // Forza il caricamento
            video.load();

            // Tenta di riprodurre il video non appena possibile
            video.addEventListener('canplaythrough', function () {
                video.play();
            }, { once: true });

            if (isMobile()) {
                // Riduce qualità o nasconde il video su mobile per migliori prestazioni
                video.setAttribute('playsinline', '');
                video.setAttribute('muted', '');
                video.setAttribute('loop', '');
                video.setAttribute('preload', 'auto');

                // Opzionale: carica un video di qualità inferiore su mobile
                // video.querySelector('source').setAttribute('src', '/assets/background2-mobile.mp4');
                video.load();
            }
        });

        // Scroll fluido per i link dell'indice
        document.querySelectorAll('.table-of-contents a').forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();

                const targetId = this.getAttribute('href').substring(1);

                // Validazione
                if (!/^[a-zA-Z0-9-]+$/.test(targetId)) {
                    console.error('ID non valido:', targetId);
                    return;
                }

                const targetElement = document.getElementById(targetId);

                if (targetElement) {
                    const navbarHeight = document.querySelector('nav').offsetHeight + 20;
                    const targetPosition = targetElement.getBoundingClientRect().top + window.scrollY - navbarHeight;

                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // Gestione dello sfondo della navbar durante lo scroll
        const header = document.querySelector('header');
        const nav = document.querySelector('nav');

        window.addEventListener('scroll', function () {
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
                nav.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
                nav.classList.remove('scrolled');
            }
        });

        // Gestione effetti fade-in al scroll
        const fadeElements = document.querySelectorAll('.fade-in-section');

        function checkFade() {
            fadeElements.forEach(element => {
                const elementTop = element.getBoundingClientRect().top;
                const windowHeight = window.innerHeight;

                if (elementTop < windowHeight - 100) {
                    element.classList.add('is-visible');
                }
            });
        }

        // Controlla all'inizio e poi ad ogni scroll
        checkFade();
        // Crea versione debounced
        const debouncedCheckFade = debounce(checkFade, 150);
        window.addEventListener('scroll', debouncedCheckFade);
    </script>

</body>

</html>